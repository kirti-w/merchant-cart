<h1>Products</h1>

<form action="/products" method="POST" class="container mb-4">
  <div class="row align-items-end g-3 p-3 shadow-sm rounded bg-light">

    <!-- Search -->
    <div class="col-md-4">
      <label class="form-label fw-semibold">Search</label>
      <input
        type="text"
        name="search"
        class="form-control"
        placeholder="Search products..."
        value="{{searchQuery}}"
      />
    </div>

    <!-- Min Price -->
    <div class="col-md-2">
      <label class="form-label fw-semibold">Min Price</label>
      <input
        type="number"
        name="minPrice"
        class="form-control"
        placeholder="$0"
        value="{{minPrice}}"
      />
    </div>

    <!-- Max Price -->
    <div class="col-md-2">
      <label class="form-label fw-semibold">Max Price</label>
      <input
        type="number"
        name="maxPrice"
        class="form-control"
        placeholder="$1000"
        value="{{maxPrice}}"
      />
    </div>

    <!-- Buttons -->
    <div class="col-md-4 d-flex gap-2">
      <button type="submit" class="btn btn-primary px-4">
        Search
      </button>

      {{#if searchQuery}}
        <a href="/products" class="btn btn-outline-secondary">
          Clear
        </a>
      {{/if}}
    </div>

  </div>
</form>

<hr />

{{#if products.length}}
  <div class="row">
    {{#each products}}
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">

            <h5 class="card-title">{{this.name}}</h5>

            <p class="card-text">
              {{this.description}}
            </p>

            <p class="fw-bold">
              ${{this.price}}
            </p>

            {{#if this.quantityInStock}}
              <p class="text-success">
                In Stock:
                {{this.quantityInStock}}
              </p>

              <form
                action="/cart/add/{{this._id}}"
                method="POST"
                class="mt-auto"
              >
                <div class="input-group">
                  <input
                    type="number"
                    name="quantity"
                    min="1"
                    max="{{this.quantityInStock}}"
                    value="1"
                    class="form-control"
                    required
                  />
                  <button class="btn btn-success" type="submit">
                    Add
                  </button>
                </div>
              </form>
            {{else}}
              <p class="text-danger fw-bold">Out of Stock</p>
            {{/if}}

          </div>
        </div>
      </div>
    {{/each}}
  </div>
{{else}}
  <div class="alert alert-warning">
    No products found.
  </div>
{{/if}}